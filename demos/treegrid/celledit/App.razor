@inject IJSRuntime JSRuntime;

<JqxTreeGrid @ref="myTreeGrid" onCellBeginEdit="cellBeginEdit" onCellEndEdit="cellEndEdit" width="width" editable="true" editSettings="editSettings" sortable="true" source="datasource" columns="columns"></JqxTreeGrid>

<div style="font-size: 13px; font-family: Verdana; width: 800px; margin-top: 20px;">
    <h4>Event Log</h4>
    <div @ref="logElement" style="max-height: 300px; overflow: auto;"></div>
</div>

@code {
    JqxTreeGrid myTreeGrid;

    ElementReference logElement;

    object width = "850";

    Dictionary<string, object> editSettings = new Dictionary<string, object>()
    {
        { "saveOnPageChange", true },
        { "saveOnBlur", true },
        { "saveOnSelectionChange", true },
        { "cancelOnEsc", true },
        { "saveOnEnter", true },
        { "editSingleCell", true },
        { "editOnDoubleClick", true },
        { "editOnF2", true }
    };

    Dictionary<string, object> datasource = new Dictionary<string, object>()
    {
        {
            "hierarchy",
            new Dictionary<string, object>()
            {
                {
                    "root", "children"
                }
            }
        },
        {
            "dataFields",
            new Dictionary<string, object>[]
            {
                new Dictionary<string, object>() { { "name", "EmployeeID" }, { "type", "number" } },
                new Dictionary<string, object>() { { "name", "FirstName" }, { "type", "string" } },
                new Dictionary<string, object>() { { "name", "LastName" }, { "type", "string" } },
                new Dictionary<string, object>() { { "name", "Country" }, { "type", "string" } },
                new Dictionary<string, object>() { { "name", "City" }, { "type", "string" } },
                new Dictionary<string, object>() { { "name", "Address" }, { "type", "string" } },
                new Dictionary<string, object>() { { "name", "Title" }, { "type", "string" } },
                new Dictionary<string, object>() { { "name", "HireDate" }, { "type", "date" } },
                new Dictionary<string, object>() { { "name", "children" }, { "type", "array" } },
                new Dictionary<string, object>() { { "name", "expanded" }, { "type", "bool" } },
                new Dictionary<string, object>() { { "name", "BirthDate" }, { "type", "date" } }
            }
        },
        { "id", "EmployeeID" },
        {
            "localdata",
            new Dictionary<string, object>[]
            {
                new Dictionary<string, object>()
                {
                    { "EmployeeID", 2 },
                    { "FirstName", "Andrew" },
                    { "LastName", "Fuller" },
                    { "Country", "USA" },
                    { "Title", "Vice President, Sales" },
                    { "HireDate", "1992-08-14 00:00:00" },
                    { "BirthDate", "1952-02-19 00:00:00" },
                    { "City", "Tacoma" },
                    { "Address", "908 W. Capital Way" },
                    { "expanded", "true" },
                    {
                        "children",
                        new Dictionary<string, object>[]
                        {
                            new Dictionary<string, object>()
                            {
                                { "EmployeeID", 8 },
                                { "FirstName", "Laura" },
                                { "LastName", "Callahan" },
                                { "Country", "USA" },
                                { "Title", "Inside Sales Coordinator" },
                                { "HireDate", "1994-03-05 00:00:00" },
                                { "BirthDate", "1958-01-09 00:00:00" },
                                { "City", "Seattle" },
                                { "Address", "4726 - 11th Ave. N.E." }
                            },
                            new Dictionary<string, object>()
                            {
                                { "EmployeeID", 1 },
                                { "FirstName", "Nancy" },
                                { "LastName", "Davolio" },
                                { "Country", "USA" },
                                { "Title", "Sales Representative" },
                                { "HireDate", "1992-05-01 00:00:00" },
                                { "BirthDate", "1948-12-08 00:00:00" },
                                { "City", "Seattle" },
                                { "Address", "507 - 20th Ave. E.Apt. 2A" }
                            },
                            new Dictionary<string, object>()
                            {
                                { "EmployeeID", 3 },
                                { "FirstName", "Janet" },
                                { "LastName", "Leverling" },
                                { "Country", "USA" },
                                { "Title", "Sales Representative" },
                                { "HireDate", "1992-04-01 00:00:00" },
                                { "BirthDate", "1963-08-30 00:00:00" },
                                { "City", "Kirkland" },
                                { "Address", "722 Moss Bay Blvd." }
                            },
                            new Dictionary<string, object>()
                            {
                                { "EmployeeID", 4 },
                                { "FirstName", "Margaret" },
                                { "LastName", "Peacock" },
                                { "Country", "USA" },
                                { "Title", "Sales Representative" },
                                { "HireDate", "1993-05-03 00:00:00" },
                                { "BirthDate", "1937-09-19 00:00:00" },
                                { "City", "Redmond" },
                                { "Address", "4110 Old Redmond Rd." }
                            },
                            new Dictionary<string, object>()
                            {
                                { "EmployeeID", 5 },
                                { "FirstName", "Steven" },
                                { "LastName", "Buchanan" },
                                { "Country", "UK" },
                                { "Title", "Sales Manager" },
                                { "HireDate", "1993-10-17 00:00:00" },
                                { "BirthDate", "1955-03-04 00:00:00" },
                                { "City", "London" },
                                { "Address", "14 Garrett Hill" },
                                { "expanded", "true" },
                                {
                                    "children",
                                    new Dictionary<string, object>[]
                                    {
                                        new Dictionary<string, object>()
                                        {
                                            { "EmployeeID", 6 },
                                            { "FirstName", "Michael" },
                                            { "LastName", "Suyama" },
                                            { "Country", "UK" },
                                            { "Title", "Sales Representative" },
                                            { "HireDate", "1993-10-17 00:00:00" },
                                            { "BirthDate", "1963-07-02 00:00:00" },
                                            { "City", "London" },
                                            { "Address", "Coventry House Miner Rd." }
                                        },
                                        new Dictionary<string, object>()
                                        {
                                            { "EmployeeID", 7 },
                                            { "FirstName", "Robert" },
                                            { "LastName", "King" },
                                            { "Country", "UK" },
                                            { "Title", "Sales Representative" },
                                            { "HireDate", "1994-01-02 00:00:00" },
                                            { "BirthDate", "1960-05-29 00:00:00" },
                                            { "City", "London" },
                                            { "Address", "Edgeham Hollow Winchester Way" }
                                        },
                                        new Dictionary<string, object>()
                                        {
                                            { "EmployeeID", 9 },
                                            { "FirstName", "Anne" },
                                            { "LastName", "Dodsworth" },
                                            { "Country", "UK" },
                                            { "Title", "Sales Representative" },
                                            { "HireDate", "1994-11-15 00:00:00" },
                                            { "BirthDate", "1966-01-27 00:00:00" },
                                            { "City", "London" },
                                            { "Address", "7 Houndstooth Rd." }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    };

    Dictionary<string, object>[] columns = new Dictionary<string, object>[]
    {
        new Dictionary<string, object>()
        {
            { "text", "First Name" },
            { "dataField", "FirstName" },
            { "width", 200 }
        },
        new Dictionary<string, object>()
        {
            { "text", "Last Name" },
            { "dataField", "LastName" },
            { "width", 200 }
        },
        new Dictionary<string, object>()
        {
            { "text", "City" },
            { "dataField", "City" },
            { "width", 200 }
        },
        new Dictionary<string, object>()
        {
            { "text", "Country" },
            { "dataField", "Country" }
        }
    };

    private void cellBeginEdit(IDictionary<string, object> e)
    {
        string value = e["value"].ToString();
        string columnDataField = e["dataField"].ToString();
        string rowKey = e["key"].ToString();        
        string message = "cellBeginEdit - Row ID: " + rowKey + ", Column: " + columnDataField + ", Value: " + value + "<br/>";
        JSRuntime.InvokeAsync<string>("Example.showMessage", logElement, message);
    }

    private void cellEndEdit(IDictionary<string, object> e)
    {
        string value = e["value"].ToString();
        string columnDataField = e["dataField"].ToString();
        string rowKey = e["key"].ToString();        
        string message = "<br/>cellEndEdit - Row ID: " + rowKey + ", Column: " + columnDataField + ", Value: " + value + "<br/>";
        JSRuntime.InvokeAsync<string>("Example.showMessage", logElement, message);
    }
}
